#!/bin/bash

COMMIT_MSG_FILE=$1

# Read and trim the first line
FIRST_LINE=$(head -n1 "$COMMIT_MSG_FILE" | xargs)

# Convert to lowercase automatically
FIRST_LINE_LOWER=$(echo "$FIRST_LINE" | tr '[:upper:]' '[:lower:]')

# Update the commit message file with lowercase first line
sed -i "1s/.*/$FIRST_LINE_LOWER/" "$COMMIT_MSG_FILE"

# Check length
if [ ${#FIRST_LINE_LOWER} -gt 40 ]; then
    echo "Commit message first line too long (>40 chars)"
    exit 1
fi

# Check starts with type:
if [[ ! "$FIRST_LINE_LOWER" =~ ^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert): ]]; then
    echo "Commit message must start with a conventional commit type (feat:, fix:, etc.)"
    exit 1
fi

exit 0
